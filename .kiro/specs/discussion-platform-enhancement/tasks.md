# 実装計画

## 概要

既存のOwlNestアプリケーションを基盤として、包括的な議論プラットフォームに発展させるための実装計画です。段階的に機能を追加し、各ステップで動作確認を行いながら進めます。

## 実装タスク

- [x] 1. プロジェクト基盤の整備とAWS環境構築

  - 既存のReactプロジェクト構造を拡張し、AWS CDKによるインフラストラクチャ設定を行う
  - TypeScript型定義の拡張、開発環境の整備、CI/CDパイプラインの基盤を構築する
  - _要件: 1.1, 1.2, 1.3_

- [x] 1.1 開発環境とプロジェクト構造の拡張

  - 既存のsrcディレクトリ構造を拡張し、新しいモジュール用のディレクトリを作成する
  - TypeScript設定を更新し、新しい型定義ファイルを追加する
  - 開発用の環境変数設定とビルド設定を更新する
  - _要件: 全般_

- [x] 1.2 AWS CDKプロジェクトの初期化

  - AWS CDKプロジェクトを作成し、基本的なスタック構造を定義する
  - DynamoDB、Lambda、API Gateway、Cognitoの基本設定を行う

  - 開発・ステージング・本番環境の分離設定を実装する
  - _要件: 1.1, 1.2, 1.3_

- [x] 1.3 基本的なCI/CDパイプラインの構築

  - GitHub Actionsまたは AWS CodePipelineを使用してCI/CDを設定する
  - 自動テスト実行、ビルド、デプロイメントの基本フローを構築する
  - 環境別デプロイメント戦略を実装する
  - _要件: 全般_

- [x] 2. 認証システムの実装（AWS Cognito統合）

  - AWS Cognitoユーザープールを設定し、フロントエンドとの統合を行う
  - ユーザー登録、ログイン、ログアウト機能を実装する

  - JWT トークンベース認証とセッション管理を構築する
  - _要件: 1.1, 1.2, 1.3_

- [x] 2.1 AWS Cognitoユーザープールの設定

  - CDKを使用してCognitoユーザープールとアプリクライアントを作成する
  - メール認証、パスワードポリシー、MFA設定を行う
  - カスタム属性（ユーザー権限）の設定を実装する
  - _要件: 1.1_

- [x] 2.2 フロントエンド認証モジュールの実装

  - AWS Amplify AuthまたはCognito SDKを使用した認証コンポーネントを作成する
  - AuthContextとカスタムフックを実装し、認証状態を管理する
  - ログイン、登録、ログアウトフォームコンポーネントを作成する

  - _要件: 1.1_

- [x] 2.3 権限管理システムの実装

  - ユーザー権限（閲覧、投稿、議論作成、管理者）の型定義と管理ロジックを実装する
  - 権限チェック用のカスタムフックとコンポーネントを作成する
  - 権限に応じたUI表示制御を実装する
  - _要件: 1.1, 1.2, 1.3_
- [x] 3. データモデルとDynamoDB設計の実装

- [ ] 3. データモデルとDynamoDB設計の実装

  - DynamoDB単一テーブル設計を実装し、基本的なCRUD操作を構築する
  - ユーザープロファイル、議論、投稿のデータ構造を定義する
  - GSIを活用した効率的なクエリパターンを実装する
  - _要件: 2.1, 2.2, 2.3, 3.1, 3.2, 3.3_

- [x] 3.1 DynamoDBテーブルとインデックスの作成

  - CDKを使用してメインテーブルとGSIを定義・作成する
  - パーティションキー、ソートキーの設計を実装する
  - テーブルの設定（オンデマンド課金、バックアップ等）を行う
  - _要件: 全般_

- [x] 3.2 データアクセス層の実装

  - DynamoDB操作用のサービスクラスとヘルパー関数を作成する
  - 型安全なCRUD操作メソッドを実装する
  - エラーハンドリングとリトライロジックを追加する
  - _要件: 全般_

- [x] 3.3 基本的なデータモデルの実装

  - User、Discussion、Post、DiscussionPointの型定義を作成する
  - バリデーション関数とデータ変換ユーティリティを実装する
  - テストデータ生成用のファクトリー関数を作成する
  - _要件: 2.1, 2.2, 2.3, 3.1, 3.2, 3.3_

- [x] 4. 議論作成・管理機能の実装

  - 議論作成フォームを実装し、カテゴリ選択と論点管理機能を追加する
  - 議論の編集・削除機能と所有者権限チェックを実装する
  - アクセス制御（ブラックリスト・ホワイトリスト）機能を構築する
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [x] 4.1 議論カテゴリシステムの実装

  - 階層構造カテゴリの定数定義とコンポーネントを作成する
  - カテゴリ選択UIコンポーネント（複数選択対応）を実装する
  - カテゴリ別フィルタリング機能を追加する
  - _要件: 2.1.1_

- [x] 4.2 議論作成フォームの実装

  - 必須項目（議題、概要、スタンス、論点、カテゴリ）の入力フォームを作成する
  - 任意項目（前提知識、アクセス制御）の入力フォームを追加する
  - フォームバリデーションとエラーハンドリングを実装する
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [x] 4.3 議論の論点管理機能の実装

  - 階層構造の論点作成・編集UIを実装する
  - ドラッグ&ドロップによる論点の並び替え機能を追加する
  - 論点の展開・折りたたみ表示機能を実装する
  - _要件: 2.1, 3.3_

- [x] 5. 投稿機能の実装

  - 返信機能とスレッド表示を構築する
  - _要件: 3.1, 3.2, 3.3_

- [x] 5.1 投稿作成フォームの実装

  - 必須項目（論点選択、意見、スタンス）の入力フォームを作成する
  - リッチテキストエディタ（太字、文字サイズ、画像・リンク埋め込み）を実装する
  - スタンスのデフォルト値設定ロジックを追加する
  - _要件: 3.1, 3.1.1_

- [x] 5.2 ファイルアップロード機能の実装

  - S3への画像・ファイルアップロード機能を実装する
  - ファイルサイズ・形式の制限とバリデーションを追加する
  - アップロード進捗表示とエラーハンドリングを実装する
  - _要件: 3.1, 3.2_

- [x] 5.3 投稿表示と管理機能の実装

  - 論点別投稿表示とフィルタリング機能を実装する
  - 投稿の編集・削除機能（所有者権限チェック付き）を追加する
  - 返信機能とスレッド表示を実装する
  - _要件: 3.3_

- [x] 5.4 議論所有者による投稿管理機能の実装

  - 議論所有者が他者の投稿を削除・非表示にする機能を実装する
  - 投稿の非表示・再表示切り替え機能を追加する
  - 投稿管理操作のログ記録と復元機能を実装する
  - _要件: 1.4_

- [x] 6. Lambda関数とAPI Gatewayの実装

  - 認証、議論管理、投稿管理用のLambda関数を作成する
  - API Gatewayエンドポイントを設定し、認証・認可を統合する
  - エラーハンドリングとログ出力を実装する
  - _要件: 全般_

- [x] 6.1 認証・ユーザー管理Lambda関数の実装

  - Cognitoトークン検証とユーザー情報取得機能を実装する
  - ユーザープロファイル管理（作成・更新・取得）機能を追加する
  - 権限管理とロール変更機能を実装する
  - _要件: 1.1, 1.2, 1.3_

- [x] 6.2 議論管理Lambda関数の実装

  - 議論のCRUD操作（作成・取得・更新・削除）を実装する
  - 議論一覧取得とフィルタリング・ソート機能を追加する
  - 所有者権限チェックとアクセス制御を実装する
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [x] 6.3 投稿管理Lambda関数の実装

  - 投稿のCRUD操作と論点別取得機能を実装する
  - 投稿フィルタリング・ソート機能を追加する
  - リアクション機能と返信管理を実装する
  - _要件: 3.1, 3.2, 3.3_

- [x] 6.4 投稿モデレーションLambda関数の実装

  - 議論所有者による投稿削除・非表示機能を実装する
  - 投稿の表示状態管理と権限チェック機能を追加する
  - モデレーション操作のログ記録と通知機能を実装する
  - _要件: 1.4_

- [x] 7. フロントエンド統合とページ実装

  - ルーティング設定を更新し、認証ガードを実装する
  - レスポンシブデザインとアクセシビリティ対応を行う
  - _要件: 全般_

- [x] 7.1 ページルーティングと認証ガードの実装

  - React Routerを使用した新しいページルートを追加する
  - 認証状態と権限に基づくルートガード機能を実装する
  - ページ遷移時のローディング状態管理を追加する
  - _要件: 1.1, 1.2_

- [x] 7.2 議論一覧ページの実装

  - 議論カード表示とフィルタリング機能を実装する
  - ページネーションと無限スクロール機能を追加する
  - 検索機能とカテゴリ別表示を実装する
  - _要件: 2.1.1, 5.1, 5.2_

- [x] 7.3 議論詳細ページの拡張

  - 既存のDiscussionPageを拡張し、新しい機能を統合する
  - 論点別投稿表示とフィルタリング機能を実装する
  - 投稿作成フォームと編集機能を追加する
  - _要件: 2.1, 3.1, 3.2, 3.3_

- [x] 8. フォロー機能とタイムラインの実装

  - ユーザーと議論のフォロー機能を実装する

  - フォローしたコンテンツのタイムライン表示を構築する
  - フォロー管理画面と通知機能を追加する
  - _要件: 6.1, 7.1_

- [x] 8.1 フォロー機能の実装

  - ユーザーフォロー・議論フォローのデータモデルを実装する
  - フォロー・アンフォローのAPI機能を追加する
  - フォローボタンとフォロー状態表示を実装する
  - _要件: 6.1_

- [x] 8.2 タイムライン機能の実装

  - フォローしたユーザー・議論の投稿を集約するタイムライン生成機能を実装する
  - タイムライン表示ページとリアルタイム更新機能を追加する
  - タイムラインのフィルタリングとソート機能を実装する
  - _要件: 6.1_

- [x] 8.3 通知システムの基盤実装

  - 通知データモデルと配信ロジックを実装する
  - フォロー関連通知の生成と表示機能を追加する
  - 通知設定と既読管理機能を実装する
  - _要件: 7.1_

- [x] 9. リアルタイム通信機能の実装

  - 新規投稿・コメントのリアルタイム配信機能を構築する
  - 接続管理とエラーハンドリングを実装する
  - _要件: 4.1, 4.2, 4.3, 4.4_

- [x] 9.1 WebSocket接続管理の実装

  - WebSocket API GatewayとLambda関数を設定する
  - 接続・切断処理とセッション管理を実装する
  - 認証済みユーザーの接続管理機能を追加する
  - _要件: 4.1, 4.2, 4.3, 4.4_

- [x] 9.2 リアルタイム投稿配信の実装

  - 新規投稿作成時のリアルタイム配信機能を実装する
  - 議論参加者への即座な通知機能を追加する
  - 投稿編集・削除のリアルタイム反映を実装する
  - _要件: 4.1, 4.2, 4.3_

- [x] 9.3 接続状態管理とエラーハンドリングの実装

  - 接続切断時の自動再接続機能を実装する
  - オフライン状態の検出と同期機能を追加する
  - WebSocket通信のエラーハンドリングを実装する
  - _要件: 4.4_

- [x] 10. 検索・フィルタリング機能の実装

  - 議論・投稿の全文検索機能を実装する
  - 高度なフィルタリング・ソート機能を構築する
  - 検索結果のハイライト表示と関連性ランキングを追加する
  - _要件: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6_

- [x] 10.1 基本検索機能の実装

  - キーワード検索とカテゴリフィルタリング機能を実装する
  - 検索結果の表示とページネーション機能を追加する
  - 検索履歴と保存機能を実装する
  - _要件: 5.1, 5.2_

- [x] 10.2 高度なフィルタリング機能の実装

  - スタンス別、ユーザー別、日付範囲でのフィルタリングを実装する
  - 複数条件の組み合わせ検索機能を追加する
  - フィルター設定の保存と復元機能を実装する
  - _要件: 5.3, 5.4, 5.5, 5.6_

- [x] 10.3 検索パフォーマンスの最適化

  - DynamoDB GSIを活用した効率的な検索クエリを実装する
  - 検索結果のキャッシュ機能を追加する
  - 検索候補の自動補完機能を実装する
  - _要件: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6_

- [x] 11. モデレーション機能の実装

  - 投稿の報告・審査機能を実装する
  - 自動コンテンツフィルタリングとモデレーションキューを構築する
  - ユーザー制裁機能（警告・一時停止・永久停止）を追加する
  - _要件: 8.1, 8.2, 8.3, 8.4_

- [x] 11.1 投稿報告システムの実装

  - 投稿報告機能とモデレーションキューを実装する
  - 報告理由の分類と優先度設定機能を追加する
  - モデレーター向けの審査画面を実装する
  - _要件: 8.1, 8.2_

- [x] 11.2 自動コンテンツフィルタリングの実装

  - 不適切コンテンツの自動検出機能を実装する
  - NGワードフィルターとスパム検出機能を追加する
  - 自動処理とモデレーター確認のワークフローを実装する
  - _要件: 8.4_

- [x] 11.3 ユーザー制裁システムの実装

  - ユーザーの警告・一時停止・永久停止機能を実装する
  - 制裁履歴の管理と自動解除機能を追加する
  - 制裁対象ユーザーへの通知機能を実装する
  - _要件: 8.3_

- [x] 12. データ分析・レポート機能の実装

  - 議論の活動統計とエンゲージメント分析機能を実装する
  - ダッシュボード表示とデータエクスポート機能を構築する
  - 傾向分析とレポート生成機能を追加する
  - _要件: 9.1, 9.2, 9.3, 9.4_

- [x] 12.1 基本統計機能の実装

  - 議論・投稿・ユーザーの基本統計情報を収集・表示する機能を実装する
  - 参加者数、投稿数、エンゲージメント率の計算機能を追加する
  - 統計データの定期更新とキャッシュ機能を実装する
  - _要件: 9.1, 9.2_

- [x] 12.2 傾向分析機能の実装

  - Pros/Consの分布分析と時系列変化の可視化機能を実装する
  - 議論の活発度とユーザー参加パターンの分析機能を追加する
  - トレンド検出とアラート機能を実装する
  - _要件: 9.3_

- [x] 12.3 データエクスポート機能の実装

  - CSV・JSON形式でのデータエクスポート機能を実装する
  - エクスポート範囲の指定とフィルタリング機能を追加する
  - 大容量データの分割エクスポート機能を実装する
  - _要件: 9.4_

- [x] 13. パフォーマンス最適化とテスト実装

  - フロントエンドの最適化（コード分割、キャッシュ、画像最適化）を実装する
  - Lambda関数の最適化とコールドスタート対策を行う
  - 包括的なテストスイート（単体・統合・E2E）を構築する
  - _要件: 全般_

- [x] 13.1 フロントエンド最適化の実装

  - React.lazyによるコード分割とルートベース分割を実装する
  - 画像の遅延読み込みと最適化機能を追加する
  - メモ化とパフォーマンス監視機能を実装する
  - _要件: 全般_

- [x] 13.2 バックエンド最適化の実装

  - Lambda関数のコールドスタート対策とメモリ最適化を実装する
  - DynamoDBクエリの最適化とキャッシュ戦略を追加する
  - API Gatewayのレスポンスキャッシュ機能を実装する
  - _要件: 全般_

- [x] 13.3 テストスイートの実装

  - 単体テスト（Jest + React Testing Library）を実装する
  - 統合テスト（API・データベース）を追加する
  - E2Eテスト（Cypress）とパフォーマンステストを実装する
  - _要件: 全般_

- [x] 14. 本番環境デプロイとモニタリング設定


  - 本番環境へのデプロイメントとドメイン設定を行う
  - 監視・ログ・アラート機能を設定する
  - セキュリティ設定とバックアップ機能を実装する
  - _要件: 全般_

- [x] 14.1 本番環境デプロイメントの実装

  - 本番用CDKスタックのデプロイとドメイン設定を行う
  - SSL証明書の設定とCDN最適化を実装する
  - 環境変数とシークレット管理を設定する
  - _要件: 全般_

- [x] 14.2 監視・ログシステムの実装

  - CloudWatchによるメトリクス監視とアラート設定を行う
  - 構造化ログとエラートラッキング機能を実装する
  - パフォーマンス監視とコスト監視を設定する
  - _要件: 全般_

- [x] 14.3 セキュリティとバックアップの実装

  - WAFとセキュリティヘッダーの設定を行う
  - DynamoDBのバックアップとポイントインタイムリカバリを設定する
  - 災害復旧計画とデータ保護機能を実装する
  - _要件: 全般_

この実装計画は、既存のOwlNestアプリケーションを段階的に拡張し、要件定義書で定義された全ての機能を実現するための詳細なロードマップです。各タスクは独立して実行可能で、段階的に機能を追加しながら動作確認を行うことができます。
