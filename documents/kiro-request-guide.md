# Kiro依頼ガイド

> OwlNestプロジェクトでKiroに修正・新機能開発・Spec更新を効率的に依頼するための完全ガイド

## 📋 目次

1. [基本的な依頼フロー](#基本的な依頼フロー)
2. [バグ修正の依頼](#バグ修正の依頼)
3. [新機能追加の依頼](#新機能追加の依頼)
4. [Spec更新の依頼](#spec更新の依頼)
5. [効果的な依頼のコツ](#効果的な依頼のコツ)
6. [依頼テンプレート集](#依頼テンプレート集)
7. [よくある問題パターン](#よくある問題パターン)

---

## 基本的な依頼フロー

### Step 1: 問題・要望の整理

- **何を解決したいのか明確にする**
- **現在の状況と期待する結果を整理する**
- **関連するファイルや機能を特定する**
- **優先度を判定する**

### Step 2: 情報収集

#### バグの場合
- 再現手順の記録
- 環境情報の収集
- エラーメッセージの取得
- 影響範囲の調査

#### 新機能の場合
- 要件の詳細化
- UI/UX要望の整理
- 技術要件の検討
- 受け入れ基準の設定

#### Spec更新の場合
- 更新対象ファイルの特定
- 更新内容の詳細化
- 更新理由の明確化

### Step 3: 依頼内容の作成

- **適切なテンプレートを選択**
- **具体的で明確な情報を提供**
- **一度に一つの課題に集中**
- **完了条件を明示**

### Step 4: 実装後の確認

- **動作テストの実施**
- **要件満足度の確認**
- **フィードバックの提供**
- **関連ドキュメントの更新確認**

---

## バグ修正の依頼

### 情報収集のポイント

#### 1. 環境情報

```text
✅ 必須情報:
- OS: Windows 11 / macOS Ventura / Ubuntu 22.04
- ブラウザ: Chrome 120.0.0.0 / Firefox 121.0 / Safari 17.0
- 画面解像度: 1920x1080 / モバイル表示
- Node.js: v18.16.0 (開発環境の場合)
- 最後に正常動作していた時期
```

#### 2. 再現手順の記録

```text
✅ 記録方法:
1. 具体的な操作を番号付きリストで記載
2. 各ステップでクリック/入力する内容を明記
3. 期待する結果と実際の結果を対比
4. スクリーンショットや動画を添付（可能であれば）
```

#### 3. エラー情報の収集

```text
✅ 収集すべきエラー情報:
- ブラウザコンソールエラー (F12 → Console)
- ネットワークエラー (F12 → Network)
- 画面に表示されるエラーメッセージ
- ログファイルのエラー（開発環境）
```

### 開発者ツールの活用

#### ブラウザコンソールでのエラー確認

```javascript
// コンソールでエラーを確認
console.log('Current user:', localStorage.getItem('user'));
console.log('Environment:', import.meta.env.VITE_NODE_ENV);

// エラーが発生した際の状態確認
console.log('Auth state:', /* 認証状態の確認 */);
console.log('Current route:', window.location.pathname);
```

#### ネットワークタブでのAPI確認

```text
✅ 確認ポイント:
- APIリクエストのステータスコード (200, 404, 500等)
- リクエストボディとレスポンスボディ
- リクエストヘッダー（認証トークン等）
- レスポンス時間
```

### 優先度の判定

- **高**: サービス停止、データ損失、セキュリティ問題
- **中**: 機能が使えない、重要なUX問題
- **低**: 軽微な表示問題、改善要望

### バグ修正依頼の例

```markdown
【バグ報告】ログイン後のリダイレクトが正常に動作しない

## 🔍 問題の概要
ログイン成功後、元いたページではなく常に/discussionsページに遷移してしまう

## 📝 再現手順
1. ブラウザで http://localhost:3002/search にアクセス（未ログイン状態）
2. 自動的に /login ページにリダイレクトされる
3. 開発環境クイックログインで「👤 一般ユーザーでログイン」をクリック
4. → **期待する結果**: /search ページに戻る
5. → **実際の結果**: /discussions ページに遷移する

## 💻 環境情報
- OS: Windows 11
- ブラウザ: Chrome 120.0.0.0
- 発生頻度: 常に（100%再現）

## 🚨 エラーログ
コンソールエラーは特になし。
ただし、Network タブで確認すると location.state?.from が undefined になっている

## 📄 関連ファイル（推測）
- src/pages/LoginPage.tsx の handleQuickLogin 関数
- src/components/routing/RouteGuard.tsx のリダイレクト処理
- src/contexts/AuthContext.tsx の認証状態管理

## ⚡ 優先度
**中** - 機能は動作するが、UXが悪化している

## ✅ 完了条件
- [ ] ログイン後、元いたページに正しくリダイレクトされる
- [ ] 既存のテストが全て通る
- [ ] 新しいテストケースが追加されている
```

---

## 新機能追加の依頼

### 要件定義の方法

#### 1. ユーザーストーリーの作成

```text
形式: As a [ユーザーの種類], I want [機能], so that [価値/理由]

例:
- As a 議論参加者, I want 投稿にリアクションできる, so that 簡単に意見を表明できる
- As a モデレーター, I want 不適切な投稿を非表示にできる, so that 健全な議論環境を維持できる
- As a 管理者, I want ユーザーの活動統計を見れる, so that サービスの利用状況を把握できる
```

#### 2. 機能の詳細化

```text
✅ 詳細化すべき項目:
- 入力: ユーザーが入力する情報
- 処理: システムが行う処理
- 出力: ユーザーに表示される結果
- 例外: エラーケースの処理
- 制約: 入力値の制限、権限の制限
```

#### 3. 非機能要件の検討

```text
✅ パフォーマンス要件:
- 応答時間: ボタンクリックから結果表示まで1秒以内
- スループット: 同時に何人のユーザーが使用できるか
- データ量: 大量のデータでも正常に動作するか

✅ セキュリティ要件:
- 認証: ログインが必要な機能か
- 認可: 特定の権限が必要な機能か
- 入力検証: 不正な入力をチェックするか

✅ アクセシビリティ要件:
- キーボード操作: マウスなしでも操作可能か
- スクリーンリーダー: 視覚障害者でも使用可能か
- 色覚: 色だけに依存しない設計か
```

### UI/UX設計の考慮点

#### 1. 一貫性の保持

```text
✅ 一貫性のチェックポイント:
- 既存のデザインパターンを踏襲
- 同じ操作は同じ方法で実行
- 用語の統一（ボタンのラベル等）
- 色使いやフォントの統一
```

#### 2. 直感的な操作

```text
✅ 直感性のチェックポイント:
- 初回利用時でも迷わない設計
- 一般的なWebアプリの操作パターンに準拠
- 適切なアイコンとラベルの使用
- フィードバックの提供（成功/エラー表示）
```

#### 3. レスポンシブ対応

```text
✅ レスポンシブ設計のポイント:
- デスクトップ（1920px以上）
- タブレット（768px-1919px）
- モバイル（767px以下）
- タッチ操作への対応
```

### 新機能依頼の例

```markdown
【新機能】ダークモード切り替え機能

## 🎯 機能概要
ユーザーがライトテーマとダークテーマを切り替えられる機能

## 💡 背景・目的
**なぜ必要か**: 暗い環境での利用時に目の負担を軽減したい
**提供価値**: ユーザーの利用環境に応じた快適な閲覧体験
**対象ユーザー**: 全ユーザー（特に長時間利用するユーザー）
**成功指標**: ダークモード利用率30%以上

## 📋 詳細要件

### 機能要件
**ユーザーストーリー**: As a ユーザー, I want テーマを切り替えられる, so that 快適な環境で利用できる

**基本機能**:
- [ ] ヘッダーにテーマ切り替えボタンを配置
- [ ] ライト/ダーク/自動の3つのモードを提供
- [ ] 設定をlocalStorageに保存（ページリロード後も維持）
- [ ] システム設定（prefers-color-scheme）の自動検出
- [ ] 全ページで一貫したテーマ適用

**ユーザーフロー**:
1. ユーザーがヘッダーの🌙/☀️アイコンをクリック
2. ドロップダウンメニューが表示（ライト/ダーク/自動）
3. ユーザーが希望のテーマを選択
4. 即座にテーマが切り替わる
5. 設定がlocalStorageに保存される

### 非機能要件
- **パフォーマンス**: テーマ切り替え時のちらつき防止
- **アクセシビリティ**: キーボード操作対応、コントラスト比確保
- **レスポンシブ**: モバイルでも操作しやすいサイズ

## 🎨 UI/UX要件

### 画面構成
- **配置**: ヘッダー右側のユーザーメニュー近く
- **アイコン**: 🌙（ダーク）/☀️（ライト）/🔄（自動）
- **メニュー**: ドロップダウン形式

### デザイン要件
- **ライトテーマ**: 白背景、黒文字
- **ダークテーマ**: 黒背景、白文字
- **アクセント色**: ブランドカラーを両テーマで調整
- **切り替えアニメーション**: スムーズな色変化

## 🔧 技術要件

### 実装方針
- **CSS変数**: テーマごとの色定義
- **React Context**: テーマ状態の管理
- **localStorage**: 設定の永続化
- **media query**: システム設定の検出

### 既存コードとの関係
- **活用するコンポーネント**: src/components/Header.tsx
- **新規作成**: 
  - src/contexts/ThemeContext.tsx
  - src/components/common/ThemeToggle.tsx
- **影響を受けるファイル**: 
  - src/styles/globals.css（CSS変数追加）
  - src/App.tsx（ThemeProvider追加）

## ✅ 受け入れ基準
- [ ] ヘッダーにテーマ切り替えボタンが表示される
- [ ] ライト/ダーク/自動の3モードが正常に動作する
- [ ] ページリロード後も選択したテーマが維持される
- [ ] システムの設定変更時に自動モードが追従する
- [ ] 全ページで一貫したテーマが適用される
- [ ] アクセシビリティ（キーボード操作、スクリーンリーダー）対応
- [ ] テストケースが作成されている

## 🎨 参考・イメージ
- GitHub のテーマ切り替え機能
- Discord のダークモード
- シンプルなアイコンベースの切り替え

## ⚡ 優先度・スケジュール
**優先度**: 中 - ユーザビリティ向上のため
**希望完了時期**: 2週間以内
**依存関係**: なし
```

---

## Spec更新の依頼

### 更新が必要なタイミング

#### 1. 要件変更時
- 新しい要件の追加
- 既存要件の修正・削除
- 優先度の変更

#### 2. 実装完了時
- タスクステータスの更新
- 実装内容の反映
- 新しい課題の記録

#### 3. 技術変更時
- アーキテクチャの変更
- 技術スタックの更新
- 設計方針の変更

### Spec更新依頼の例

```markdown
【Spec更新依頼】ダークモード機能追加に伴うドキュメント更新

## 📄 更新対象ファイル
- [ ] .kiro/specs/discussion-platform-enhancement/requirements.md
- [ ] .kiro/specs/discussion-platform-enhancement/design.md
- [ ] .kiro/specs/discussion-platform-enhancement/tasks.md

## 🔄 更新内容

### requirements.md の更新
新規要件として「Requirement 15: テーマ切り替え機能」を追加

### design.md の更新
「Theme System Architecture」セクションを追加し、CSS変数とReact Contextによるテーマ管理方式を記載

### tasks.md の更新
タスク15として「テーマ切り替え機能の実装」を追加（6つのサブタスクを含む）

## 📝 詳細な更新指示

### requirements.md への追加内容
```markdown
### Requirement 15: テーマ切り替え機能

**User Story:** As a user, I want to switch between light and dark themes, so that I can use the app comfortably in different lighting conditions

#### Acceptance Criteria
1. WHEN user clicks theme toggle button THEN system SHALL switch between light and dark mode
2. WHEN user refreshes page THEN system SHALL remember the selected theme
3. WHEN user has not selected theme THEN system SHALL follow browser's preferred color scheme
4. WHEN theme changes THEN all UI components SHALL update consistently
```

### design.md への追加内容
```markdown
### Theme System Architecture
- CSS Custom Properties for theme variables
- React Context for theme state management
- localStorage for persistence
- prefers-color-scheme media query support

### Component Design
- ThemeProvider context component
- useTheme custom hook
- ThemeToggle component in header
```

### tasks.md への追加内容
```markdown
- [ ] 15. テーマ切り替え機能の実装
  - [ ] 15.1 CSS変数によるテーマシステム構築
  - [ ] 15.2 ThemeProvider とuseTheme hook実装
  - [ ] 15.3 ヘッダーにテーマ切り替えボタン追加
  - [ ] 15.4 localStorage による設定永続化
  - [ ] 15.5 prefers-color-scheme 対応
  - [ ] 15.6 全コンポーネントのテーマ対応
  - [ ] 15.7 テストケース実装
```

## 🎯 更新の理由
新機能「ダークモード切り替え」の実装に向けて、要件・設計・タスクを文書化する必要があるため

## ⚡ 優先度
**中** - 新機能追加のため
```

---

## 効果的な依頼のコツ

### ✅ 良い依頼の特徴

#### 1. 具体的で明確
- 曖昧な表現を避ける
- 具体的な例を提供する
- 期待する結果を明示する

#### 2. 必要な情報が揃っている
- 再現手順が詳細（バグの場合）
- 要件が具体的（新機能の場合）
- 更新内容が明確（Spec更新の場合）

#### 3. 優先度と完了条件が明確
- なぜ重要なのか理由を説明
- 何をもって完了とするか明示
- テスト方法も含める

#### 4. 段階的なアプローチ
- 一度に複数の課題を依頼しない
- 依存関係を考慮した順序
- 確認ポイントを設ける

### ❌ 避けるべき依頼の例

```text
❌ 悪い例:
「ログインがうまくいきません。直してください。」
「プロフィール機能とダークモードと通知機能を全部追加してください。」
「なんかエラーが出ます。」
```

### ✅ 良い依頼の例

```text
✅ 良い例:
「src/pages/LoginPage.tsx の handleQuickLogin 関数で、
ログイン成功後のリダイレクト先が常に/discussionsになってしまいます。
location.state?.from?.pathname を使用して元のページに戻るように修正してください。」

「まずはダークモード機能の基本実装をお願いします。
完了後、プロフィール機能について別途相談させてください。」

「ブラウザのコンソールに『TypeError: Cannot read property 'user' of undefined』
というエラーが表示され、src/contexts/AuthContext.tsx の getCurrentUser 関数が
原因と思われます。」
```

---

## 依頼テンプレート集

### バグ修正テンプレート

```markdown
【バグ報告】[機能名] - [問題の簡潔な説明]

## 🔍 問題の概要
[何が起きているかを1-2文で説明]

## 📝 再現手順
1. [具体的な操作1]
2. [具体的な操作2]
3. [具体的な操作3]
4. → **期待する結果**: [期待する動作]
5. → **実際の結果**: [実際に起きる動作]

## 💻 環境情報
- OS: [OS名とバージョン]
- ブラウザ: [ブラウザ名とバージョン]
- 画面サイズ: [デスクトップ/モバイル/タブレット]
- 発生頻度: [常に/時々/稀に]
- 最後の正常動作: [いつまで正常だったか]

## 🚨 エラーログ
```
[コンソールエラーやログをここに貼り付け]
```

## 📄 関連ファイル（推測）
[問題に関連していそうなファイル]
- src/components/[ComponentName].tsx
- src/services/[ServiceName].ts
- src/pages/[PageName].tsx

## 📊 影響範囲
- 影響を受ける機能: [機能名]
- ユーザーへの影響: [高/中/低]
- 回避策: [あれば記載、なければ「なし」]

## ⚡ 優先度
**[高/中/低]** - [理由]

## ✅ 完了条件
- [ ] [条件1]
- [ ] [条件2]
- [ ] [条件3]
```

### 新機能追加テンプレート

```markdown
【新機能】[機能名]

## 🎯 機能概要
[機能の簡潔な説明（1-2文）]

## 💡 背景・目的
**なぜ必要か**: [機能が必要な理由]
**提供価値**: [ユーザーにとっての価値]
**対象ユーザー**: [主な利用者]
**成功指標**: [どうなれば成功か]

## 📋 詳細要件

### 機能要件
**ユーザーストーリー**: As a [ユーザー], I want [機能], so that [価値]

**基本機能**:
- [ ] [機能1の説明]
- [ ] [機能2の説明]
- [ ] [機能3の説明]

**ユーザーフロー**:
1. [ユーザーの操作1]
2. [システムの応答1]
3. [ユーザーの操作2]
4. [システムの応答2]

### 非機能要件
- **パフォーマンス**: [応答時間、処理能力の要件]
- **セキュリティ**: [認証、認可、データ保護の要件]
- **アクセシビリティ**: [キーボード操作、スクリーンリーダー対応]
- **レスポンシブ**: [モバイル、タブレット対応の要件]

## 🎨 UI/UX要件

### 画面構成
- **レイアウト**: [画面の構成要素]
- **ナビゲーション**: [画面間の遷移]
- **操作フロー**: [ユーザーの操作手順]

### デザイン要件
- **デザインシステム**: [既存のデザインパターンを踏襲]
- **色使い**: [ブランドカラーの使用]
- **アイコン**: [使用するアイコンの種類]
- **フィードバック**: [成功/エラー時の表示]

## 🔧 技術要件

### 実装方針
- **使用技術**: [React, TypeScript等の技術選択]
- **既存連携**: [既存システムとの連携方法]
- **データ設計**: [新規データ構造、既存データの拡張]
- **API設計**: [新規API、既存APIの拡張]

### 既存コードとの関係
- **活用するコンポーネント**: [再利用する既存コンポーネント]
- **拡張するサービス**: [拡張する既存サービス]
- **影響を受けるファイル**: [修正が必要な既存ファイル]

## ✅ 受け入れ基準
- [ ] [基準1: 具体的で測定可能な基準]
- [ ] [基準2: 具体的で測定可能な基準]
- [ ] [基準3: 具体的で測定可能な基準]
- [ ] 単体テストが作成されている
- [ ] 統合テストが作成されている
- [ ] アクセシビリティテストが通る
- [ ] レスポンシブデザインが正しく動作する
- [ ] ドキュメントが更新されている

## 🎨 参考・イメージ
[参考にしたいUI/UXがあれば記載]
- [参考サイト名]: [URL] - [参考にしたい点]
- [参考アプリ名]: [参考にしたい機能]

## ⚡ 優先度・スケジュール
**優先度**: [高/中/低] - [理由]
**希望完了時期**: [いつまでに必要か]
**依存関係**: [他の機能との依存関係]

## 📝 補足事項
[その他の重要な情報、制約事項、注意点]
```

### Spec更新テンプレート

```markdown
【Spec更新依頼】[更新内容の簡潔な説明]

## 📄 更新対象ファイル
- [ ] .kiro/specs/[feature-name]/requirements.md
- [ ] .kiro/specs/[feature-name]/design.md
- [ ] .kiro/specs/[feature-name]/tasks.md

## 🔄 更新内容

### [ファイル名] の更新
[具体的な更新内容]

## 📝 詳細な更新指示

### 新規追加する内容
```
[追加するマークダウンの内容をここに記載]
```

### 修正する内容
**修正前:**
```
[現在の内容]
```

**修正後:**
```
[修正後の内容]
```

### 削除する内容
```
[削除する内容]
```

## 🎯 更新の理由
[なぜこの更新が必要なのか]

## ⚡ 優先度
**[高/中/低]** - [理由]

## ✅ 確認事項
- [ ] 実装内容との整合性
- [ ] 他のドキュメントとの一貫性
- [ ] バージョン情報の更新
```

---

## よくある問題パターン

### 1. 認証関連の問題

#### よくある症状
- ログインできない
- ログイン後にリダイレクトされない
- 認証状態が保持されない
- 権限エラーが発生する

#### 収集すべき情報

```text
✅ 認証問題の調査ポイント:
- 使用した認証方法（クイックログイン/手動入力）
- ブラウザのlocalStorageの内容
- Network タブでの認証APIの応答
- コンソールでの認証エラー
- 他のブラウザでの動作確認
```

#### 依頼時のポイント

```markdown
## 🔐 認証情報の確認
- 使用した認証方法: [クイックログイン/手動入力]
- 入力した情報: [メールアドレス（個人情報は伏せる）]
- localStorage の auth 情報: [あり/なし/エラー]
- 他のブラウザでの動作: [正常/同じ問題]
```

### 2. UI/レイアウトの問題

#### よくある症状
- レスポンシブデザインが崩れる
- ボタンが押せない
- テキストが見切れる
- 要素が重なって表示される

#### 収集すべき情報

```text
✅ UI/レイアウト問題の調査ポイント:
- 画面サイズ（具体的なピクセル数）
- ブラウザのズーム倍率
- 他の画面サイズでの動作確認
- CSS の computed styles の確認
- 他のブラウザでの表示確認
```

### 3. データ表示の問題

#### よくある症状
- データが表示されない
- 古いデータが表示される
- データの更新が反映されない
- 検索結果が正しくない

#### 収集すべき情報

```text
✅ データ表示問題の調査ポイント:
- Network タブでのAPI応答の確認
- 期待するデータと実際のデータの比較
- ブラウザキャッシュの影響確認
- 他のユーザー/環境での動作確認
```

### 4. パフォーマンスの問題

#### よくある症状
- ページの読み込みが遅い
- 操作の応答が遅い
- メモリ使用量が多い
- CPUの使用率が高い

#### 収集すべき情報

```text
✅ パフォーマンス問題の調査ポイント:
- Performance タブでの測定結果
- Network タブでの通信時間
- Memory タブでのメモリ使用量
- 具体的な応答時間の測定
```

---

## 実装後の確認

### 修正・実装内容の確認

1. **修正されたファイルの確認**: どのファイルが変更されたか
2. **修正・実装内容の理解**: なぜそのバグが発生したか、どのように機能が実装されたか
3. **テストケースの確認**: 同様の問題を防ぐテストが追加されたか

### 動作確認

1. **基本動作の確認**: 報告した問題が解決されているか、要件通りに機能が動作するか
2. **回帰テストの実行**: 他の機能に影響がないか
3. **エッジケースの確認**: 境界値や特殊な条件での動作

### フィードバック

```markdown
## ✅ 確認完了

**実装内容**: [実装・修正されたポイント]
**動作確認**: [確認した内容]
**追加で気づいた点**: [あれば記載]

ありがとうございました！
```

---

## チェックリスト

### 依頼前チェックリスト

- [ ] 問題・要望が明確に整理されている
- [ ] 必要な情報（環境、手順、要件等）が収集されている
- [ ] 関連ファイルが特定されている
- [ ] 優先度と理由が明示されている
- [ ] 完了条件が明確になっている
- [ ] 一度に一つの課題に集中している
- [ ] 適切なテンプレートを選択している

### 実装後チェックリスト

- [ ] 報告した問題が解決されている / 要件が満たされている
- [ ] 他の機能に影響がない
- [ ] 実装・修正内容を理解した
- [ ] テストケースが適切に作成されている
- [ ] ドキュメントが更新されている
- [ ] フィードバックを提供した
- [ ] 感謝の気持ちを伝えた

---

**最終更新**: 2025-08-06  
**バージョン**: 2.0  
**作成者**: OwlNest開発チーム